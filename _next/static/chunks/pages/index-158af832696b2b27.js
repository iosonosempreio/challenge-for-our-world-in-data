(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return __webpack_require__(6940)}])},6940:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";let svg,bubble,stroke,label,historyLine;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return Home}});var jsx_runtime=__webpack_require__(5893),head=__webpack_require__(9008),head_default=__webpack_require__.n(head),react=__webpack_require__(7294),Container=__webpack_require__(682),Row=__webpack_require__(4051),Col=__webpack_require__(1555),BubbleChart_module=__webpack_require__(335),BubbleChart_module_default=__webpack_require__.n(BubbleChart_module),classnames=__webpack_require__(4184),classnames_default=__webpack_require__.n(classnames),src=__webpack_require__(2228);let x=(0,src.BYU)().clamp(!0),y=(0,src.BYU)().clamp(!0),r=(0,src.PUr)(),fillColor=(0,src.PKp)(),width,height,margin={top:50,right:50,bottom:50,left:50},valueline=(0,src.jvg)().defined(d=>d.gdp&&d.lifeExpectancy).curve(src.YY7).x(d=>x(d.gdp)).y(d=>y(d.lifeExpectancy));function BubbleChart(param){let{data,selectedYear}=param,svgEl=(0,react.useRef)();return(0,react.useEffect)(()=>{!function(selection){console.log("init"),svg=selection;let bbox=svg.node().getBoundingClientRect();width=bbox.width,height=bbox.height,svg.select(".bubbles").selectAll("*").remove(),historyLine=svg.select(".bubbles").append("path").attr("class",".historyLine").attr("fill","none"),bubble=svg.select(".bubbles").selectAll(".bubble"),stroke=svg.select(".bubbles").selectAll(".stroke"),label=svg.select(".bubbles").selectAll(".label")}((0,src.Ys)(svgEl.current))},[]),(0,react.useEffect)(()=>{!function(data){x.domain(data.extents.gdpExtent).range([margin.left,width-margin.right]),y.domain(data.extents.lifeExtent).range([height-margin.bottom,margin.top]),r.domain([0,data.extents.populationExtent[1]]).range([2,100]),fillColor.domain(data.extents.continents).range(["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]),svg.select(".xAxis").attr("transform","translate(0,".concat(height-margin.bottom,")")).call((0,src.LLu)(x)),svg.select(".yAxis").attr("transform","translate(".concat(margin.left,",0)")).call((0,src.y4O)(y));let t=svg.transition().duration(750);bubble=bubble.data(data.dataset,d=>d.Code).join(enter=>enter.append("circle").attr("class","bubble").attr("data-code",d=>d.Code).attr("r",d=>0).attr("cx",d=>x(d.gdp)).attr("cy",d=>y(d.lifeExpectancy)).attr("fill",d=>fillColor(d.continent)).on("mouseover",(event,d)=>{let history=data.histories.find(dd=>dd[0]===d.Entity)[1];historyLine.attr("d",valueline(history)).attr("stroke",dd=>fillColor(d.continent)).style("opacity",0).transition().duration(750).style("opacity",1),label.filter(dd=>dd.Entity===d.Entity).style("display","block")}).on("mouseleave",(event,d)=>{historyLine.attr("d",null).transition().duration(750).style("opacity",0),label.style("display",(d,i)=>i<10?"block":"none")}).call(enter=>enter.transition(t).attr("r",d=>r(d["Population (historical estimates)"]))),update=>update.attr("cx",d=>x(d.gdp)).attr("cy",d=>y(d.lifeExpectancy)).attr("r",d=>r(d["Population (historical estimates)"])),exit=>exit.call(exit=>exit.transition(t).style("opacity",0).remove())),stroke=stroke.data(data.dataset,d=>d.Code).join(enter=>enter.append("circle").attr("class","stroke").attr("data-code",d=>d.Code).attr("r",d=>0).attr("cx",d=>x(d.gdp)).attr("cy",d=>y(d.lifeExpectancy)).attr("fill","none").attr("stroke","white").style("opacity",.5).call(enter=>enter.transition(t).attr("r",d=>r(d["Population (historical estimates)"]))),update=>update.attr("cx",d=>x(d.gdp)).attr("cy",d=>y(d.lifeExpectancy)).attr("r",d=>r(d["Population (historical estimates)"])),exit=>exit.call(exit=>exit.transition(t).style("opacity",0).remove())),label=label.data(data.dataset,d=>d.Code).join(enter=>enter.append("text").attr("class","label").attr("data-code",d=>d.Code).attr("x",d=>x(d.gdp)).attr("y",d=>y(d.lifeExpectancy)-r(d["Population (historical estimates)"])).attr("fill","#444").attr("font-size",12).attr("text-anchor","middle").style("opacity",0).text(d=>d.Entity).style("display",(d,i)=>i<10?"block":"none").call(enter=>enter.transition(t).style("opacity",1)),update=>update.attr("x",d=>x(d.gdp)).attr("y",d=>y(d.lifeExpectancy)-r(d["Population (historical estimates)"])).style("display",(d,i)=>i<10?"block":"none").raise(),exit=>exit.call(exit=>exit.transition(t).style("opacity",0).remove()))}(data,selectedYear)},[data,selectedYear]),(0,jsx_runtime.jsxs)("svg",{ref:svgEl,className:classnames_default()(BubbleChart_module_default().bubbleChartSVG),children:[(0,jsx_runtime.jsx)("g",{className:"xAxis"}),(0,jsx_runtime.jsx)("g",{className:"yAxis"}),(0,jsx_runtime.jsx)("g",{className:"bubbles"})]})}var router=__webpack_require__(1163),Form=__webpack_require__(2671);function RangeInput(param){let{extent,value,setValue}=param;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(Form.Z.Label,{children:["Selected year: ",value]}),(0,jsx_runtime.jsx)(Form.Z.Range,{onChange:e=>setValue(e.target.value),min:extent[0],max:extent[1],defaultValue:value})]})}function Home(){let{basePath}=(0,router.useRouter)(),[fullData,setFullData]=(0,react.useState)(),[data,setData]=(0,react.useState)(),[selectedYear,setSelectedYear]=(0,react.useState)();return(0,react.useEffect)(()=>{let requests=[(0,src.gyn)(basePath+"/data/population.csv",src.rA8),(0,src.gyn)(basePath+"/data/life-expectancy.csv",src.rA8),(0,src.gyn)(basePath+"/data/gdp-per-capita-maddison-2020.csv",src.rA8),(0,src.gyn)(basePath+"/data/continents-according-to-our-world-in-data.csv",src.rA8)];Promise.all(requests).then(results=>{let continents=(0,src.Xxj)(results[3],d=>d.Continent).map(d=>d[0]),populationExtent=(0,src.Wem)(results[0],d=>d["Population (historical estimates)"]),datasets=results.map(dataset=>dataset.filter(d=>"OWID_WRL"!==d.Code&&d.Year>=1810&&d.Year<=2018)),histories=(0,src.Q3u)(datasets[0],v=>{let life=datasets[1].filter(r=>r.Entity===v[0].Entity),gdp=datasets[2].filter(r=>r.Entity===v[0].Entity);return v.map(d=>{var ref,ref1;return{year:d.Year,lifeExpectancy:null===(ref=life.find(l=>l.Year===d.Year))||void 0===ref?void 0:ref["Life expectancy"],gdp:null===(ref1=gdp.find(g=>g.Year===d.Year))||void 0===ref1?void 0:ref1["GDP per capita"]}})},d=>d.Entity);setFullData({datasets,histories,extents:{populationExtent,timeExtent:[1810,2018],lifeExtent:[35,90],gdpExtent:[0,8e4],continents}}),setSelectedYear(1810)})},[]),(0,react.useEffect)(()=>{if(fullData&&selectedYear){let dataset=(0,src.Q3u)(fullData.datasets[0],v=>v.find(vv=>vv.Year==selectedYear),d=>d.Entity);dataset=(dataset=(dataset=(dataset=dataset.filter(d=>d[1])).map(d=>{let datum=d[1],continentRecord=fullData.datasets[3].find(record=>record.Entity===datum.Entity);continentRecord&&(datum.continent=continentRecord.Continent);let lifeExpectancyRecord=fullData.datasets[1].find(record=>record.Entity===datum.Entity&&record.Year==selectedYear);lifeExpectancyRecord&&(datum.lifeExpectancy=lifeExpectancyRecord["Life expectancy"]);let gdpRecord=fullData.datasets[2].find(record=>record.Entity===datum.Entity&&record.Year==selectedYear);return gdpRecord&&(datum.gdp=gdpRecord["GDP per capita"]),datum})).filter(d=>d.lifeExpectancy&&d.gdp)).sort((a,b)=>b["Population (historical estimates)"]-a["Population (historical estimates)"]),setData({dataset,histories:fullData.histories,extents:{...fullData.extents}})}},[fullData,selectedYear]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(head_default(),{children:(0,jsx_runtime.jsx)("title",{children:"Human progress | Interactive bubble chart"})}),(0,jsx_runtime.jsxs)(Container.Z,{children:[(0,jsx_runtime.jsx)(Row.Z,{children:(0,jsx_runtime.jsx)(Col.Z,{children:(0,jsx_runtime.jsx)("h1",{children:"Interactive bubble chart of human progress"})})}),data&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Row.Z,{children:(0,jsx_runtime.jsx)(Col.Z,{children:(0,jsx_runtime.jsx)(RangeInput,{extent:data.extents.timeExtent,value:selectedYear,setValue:setSelectedYear})})}),(0,jsx_runtime.jsx)(Row.Z,{children:(0,jsx_runtime.jsx)(Col.Z,{style:{height:"70vh"},children:(0,jsx_runtime.jsx)(BubbleChart,{data:data,selectedYear:selectedYear})})})]})]})]})}},335:function(module){module.exports={bubbleChartSVG:"BubbleChart_bubbleChartSVG__m0Nbo"}}},function(__webpack_require__){__webpack_require__.O(0,[111,774,888,179],function(){return __webpack_require__(__webpack_require__.s=5557)}),_N_E=__webpack_require__.O()}]);